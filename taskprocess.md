# ä»»åŠ¡æµç¨‹æ–‡æ¡£ (Task Process Documentation)

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªåŸºäºåŒºå—é“¾çš„ä¼šå‘˜æ¨èç³»ç»Ÿï¼ŒåŒ…å«NFTä¼šå‘˜åˆ¶åº¦ã€3Ã—3çŸ©é˜µæ¨èæ ‘ã€å±‚çº§å¥–åŠ±åˆ†é…ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ä¸»è¦æŠ€æœ¯æ ˆ
- Frontend: React + TypeScript
- Backend: Supabase (Database + Edge Functions)  
- Blockchain: Thirdweb In-App Wallet + EditionDrop NFT
- Database: PostgreSQL (é€šè¿‡Supabase)

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 1. å®Œæ•´ç”¨æˆ·æ³¨å†Œæ¿€æ´»æµç¨‹
```
1. é’±åŒ…è¿æ¥ (Thirdweb In-App Wallet)
   â†“
2. æ³¨å†Œé¡µé¢ (username + email + referreræ•è·)
   â†“  
3. usersè¡¨è®°å½• (wallet_address, username, email, referrer_wallet)
   â†“
4. welcomeé¡µé¢ (éä¼šå‘˜åªèƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢)
   â†“
5. claim Membership NFT Level 1 (token_id=1, 130 USDC)
   - 100 USDC = NFT Level 1 ä»·æ ¼
   - 30 USDC = å¹³å°æ¿€æ´»è´¹
   â†“
6. é“¾ä¸Šäº¤æ˜“ç¡®è®¤ (3ç§æ–¹å¼: Arbitrum One/Sepolia/Simulation)
   â†“  
7. æ¿€æ´»åå¤„ç†:
   - ordersè¡¨è®°å½•è®¢å•
   - nft_purchasesè¡¨è®°å½•NFTè´­ä¹°
   - membersè¡¨æ’å…¥ä¼šå‘˜è®°å½• (is_activated=true, current_level=1)
   - referralsè¡¨æ’å…¥æ¨èçŸ©é˜µå®‰ç½®
   - è‡ªåŠ¨è·å¾—500 BCC unlocked balance
   - æ ¹æ®æ¿€æ´»é¡ºåºè·å¾—tier-based locked BCC (Level 1 = 100 BCC)
   â†“
8. dashboard (åªæœ‰æ¿€æ´»ä¼šå‘˜æ‰èƒ½è®¿é—®)
```

### 2. 3Ã—3çŸ©é˜µæ¨èç³»ç»Ÿè¯¦ç»†é€»è¾‘
```
æ–°ä¼šå‘˜æ¿€æ´» -> 
æŸ¥æ‰¾referreråœ¨æ¨èæ ‘ä¸­çš„ä½ç½® -> 
å¯»æ‰¾ç¬¬ä¸€ä¸ªä¸å®Œæ•´çš„ä¸‹çº¿å±‚çº§ (Lâ†’Mâ†’Rä¼˜å…ˆçº§) ->
å°†æ–°ä¼šå‘˜ä½œä¸ºè¯¥ä¸å®Œæ•´æˆå‘˜çš„ç¬¬ä¸€å±‚ä¸‹çº¿å®‰ç½® ->
å½¢æˆæ¯ä¸ªä¼šå‘˜çš„19å±‚çŸ©é˜µ:
  Layer 1: 3 ä¸ªæˆå‘˜
  Layer 2: 3Â² = 9 ä¸ªæˆå‘˜  
  Layer 3: 3Â³ = 27 ä¸ªæˆå‘˜
  ...
  Layer 19: 3Â¹â¹ ä¸ªæˆå‘˜
```

### 3. å¥–åŠ±ç³»ç»Ÿæ¶æ„
#### Layer Rewards (å±‚çº§å¥–åŠ±)
- å½“ä¸‹çº¿æˆå‘˜è¾¾åˆ°æŸç­‰çº§æ—¶ï¼Œè¯¥æ ‘çš„rootæˆå‘˜è·å¾—è¯¥å±‚çº§å¥–åŠ±
- å¥–åŠ±é‡‘é¢ = è¯¥ç­‰çº§NFTä»·æ ¼
- é¢†å–æ¡ä»¶: Rootå¿…é¡»å·²æŒæœ‰ â‰¥ è¯¥ç­‰çº§
- å¦‚æœªè¾¾åˆ°: å¥–åŠ±è¿›å…¥pendingçŠ¶æ€ (72å°æ—¶å‡çº§æœŸé™)
- è¶…æ—¶æœªå‡çº§: å¥–åŠ±roll upåˆ°ä¸Šä¸€çº§åˆæ ¼æˆå‘˜

#### Locked BCC Release (é”ä»“BCCé‡Šæ”¾)
åŸºäºæ¿€æ´»é¡ºåºçš„tieråˆ†é…:
- Tier 1 (ç¬¬1-9,999å): å…¨é¢å¥–åŠ±
- Tier 2 (ç¬¬10,000-29,999å): å¥–åŠ±å‡åŠ  
- Tier 3 (ç¬¬30,000-99,999å): å¥–åŠ±å†å‡åŠ
- Tier 4 (ç¬¬100,000-268,240å): å¥–åŠ±å†å‡åŠ

#### New Activation Bonus
- æ¯ä¸ªæ–°ä¼šå‘˜è‡ªåŠ¨è·å¾—500 BCC unlocked balance

## å½“å‰ä»»åŠ¡çŠ¶æ€

### Phase 1: APIæ¶æ„é‡æ„ âœ… **å·²å®Œæˆ** (2024-09-07)
- [âœ…] **é‡æ„APIè°ƒç”¨æ–¹å¼**: ç§»é™¤å¤æ‚hooksï¼Œæ”¹ç”¨ç›´æ¥Supabaseå®¢æˆ·ç«¯å’ŒEdge Functions
- [âœ…] **åˆ›å»ºç»Ÿä¸€Supabaseå®¢æˆ·ç«¯**: é›†æˆdatabase.types.tsç±»å‹å®šä¹‰ï¼Œåˆ›å»ºauthService/nftService/balanceServiceç­‰æœåŠ¡
- [âœ…] **é‡æ„ç°æœ‰é¡µé¢ç»„ä»¶**: æ›´æ–°useWallet hookï¼Œä½¿ç”¨æ–°çš„Supabase APIè°ƒç”¨æ–¹å¼
- [âœ…] **Headerç»„ä»¶ä¼˜åŒ–**: ç®€åŒ–ä¸ºåªæœ‰é’±åŒ…è¿æ¥æŒ‰é’®ï¼Œæ·»åŠ å¤šè¯­è¨€ç¿»è¯‘æ”¯æŒ

### Phase 2: ç”¨æˆ·æ³¨å†Œæ¿€æ´»æµç¨‹ âœ… **å·²å®Œæˆ** (2024-09-07)  
- [âœ…] **ç”¨æˆ·æ³¨å†Œæµç¨‹**: walletè¿æ¥ â†’ æ³¨å†Œå¼¹çª— â†’ usersè¡¨è®°å½•ï¼Œé›†æˆreferreré“¾æ¥æ•è·
- [âœ…] **MemberGuardè®¿é—®æ§åˆ¶**: åˆ›å»ºå…¨ç«™è®¿é—®ä¿æŠ¤ï¼Œé’±åŒ…æ–­è¿è‡ªåŠ¨è·³è½¬landingï¼Œéä¼šå‘˜è‡ªåŠ¨è·³è½¬welcome
- [âœ…] **RegistrationModalæ³¨å†Œå¼¹çª—**: é’±åŒ…è¿æ¥åè‡ªåŠ¨å¼¹å‡ºï¼Œæ”¶é›†ç”¨æˆ·ä¿¡æ¯å’Œreferreråœ°å€
- [ğŸ”„] **Welcomeé¡µé¢**: éä¼šå‘˜è®¿é—®é™åˆ¶ï¼ŒNFT claimç•Œé¢ (è¿›è¡Œä¸­)
- [â³] **NFT claimç­‰å¾…æœºåˆ¶**: é“¾ä¸Šäº¤æ˜“ç¡®è®¤ä¸çŠ¶æ€è¿½è¸ª
- [â³] **æ¿€æ´»åå¤„ç†**: orders/nft_purchases/members/referralsè¡¨æ•°æ®æ’å…¥

### Phase 3: 3Ã—3çŸ©é˜µæ¨èç³»ç»Ÿ (ä¼˜å…ˆçº§: é«˜)
- [â³] **çŸ©é˜µå®‰ç½®ç®—æ³•**: Lâ†’Mâ†’Rä¼˜å…ˆçº§ï¼Œå¯»æ‰¾ç¬¬ä¸€ä¸ªä¸å®Œæ•´ä¸‹çº¿å±‚
- [â³] **referralsè¡¨ç®¡ç†**: å®‰ç½®ä½ç½®è®¡ç®—ä¸è®°å½•
- [â³] **çŸ©é˜µæ ‘æ„å»º**: æ”¯æŒ19å±‚æ·±åº¦çš„3Ã—3çŸ©é˜µç»“æ„

### Phase 4: å¥–åŠ±ç³»ç»Ÿå®ç° (ä¼˜å…ˆçº§: ä¸­)
- [â³] **Layer Rewards**: å±‚çº§å¥–åŠ±è§¦å‘ä¸pending/rollupæœºåˆ¶
- [â³] **Locked BCC Release**: åŸºäºæ¿€æ´»é¡ºåºçš„tieråˆ†é…ç³»ç»Ÿ  
- [â³] **New Activation Bonus**: 500 BCCè‡ªåŠ¨å‘æ”¾
- [â³] **ä½™é¢ç®¡ç†**: BCC locked/unlocked/transferableåˆ†ç±»ç®¡ç†

### Phase 5: ç‰¹æ®Šä¸šåŠ¡è§„åˆ™ (ä¼˜å…ˆçº§: ä¸­)
- [â³] **Level 2å‡çº§é™åˆ¶**: éœ€è¦3ä¸ªç›´æ¨æ¿€æ´»ä¼šå‘˜
- [â³] **Layer 1 Right slotå¥–åŠ±**: éœ€è¦Level 2æ‰èƒ½é¢†å–  
- [â³] **72å°æ—¶pendingæœŸé™**: è¶…æ—¶è‡ªåŠ¨rollupæœºåˆ¶

### Phase 6: æ•°æ®åŒæ­¥ä¸ä¼˜åŒ– (ä¼˜å…ˆçº§: ä½)
- [â³] **Supabase CLIç±»å‹åŒæ­¥**: ä¿æŒdatabase.types.tsæœ€æ–°
- [âœ…] **ä»»åŠ¡æµç¨‹æ–‡æ¡£**: è®°å½•ä¸šåŠ¡é€»è¾‘ä¸å¼€å‘è¿›åº¦

## æŠ€æœ¯è¦æ±‚

### APIè°ƒç”¨ä¼˜åŒ–
- âŒ é¿å…ä½¿ç”¨å¤æ‚çš„hooks apiè·¯ç”±æ–¹å¼
- âœ… ä½¿ç”¨ç›´æ¥çš„Supabase APIè°ƒç”¨
- âœ… ä½¿ç”¨Supabase Edge Functionsè¿›è¡ŒæœåŠ¡ç«¯é€»è¾‘

### æ•°æ®åº“è¡¨ç»“æ„ï¼ˆä¸»è¦ç›¸å…³è¡¨ï¼‰
- `users`: ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- `members`: ä¼šå‘˜ä¿¡æ¯å’ŒçŠ¶æ€
- `referrals`: æ¨èå…³ç³»å’ŒçŸ©é˜µå®‰ç½®
- `orders`: è®¢å•è®°å½•
- `nft_purchases`: NFTè´­ä¹°è®°å½•
- `layer_rewards`: å±‚çº§å¥–åŠ±è®°å½•
- `reward_claims`: å¥–åŠ±ç”³é¢†è®°å½•

## å¼€å‘è¿›åº¦è®°å½•

### 2024-09-07 (APIæ¶æ„é‡æ„ + ç”¨æˆ·æ³¨å†Œæµç¨‹)
#### å·²å®Œæˆ âœ…
- **APIæ¶æ„å…¨é¢é‡æ„**: ç§»é™¤å¤æ‚hooks APIè·¯ç”±ï¼Œæ”¹ç”¨ç›´æ¥Supabaseå®¢æˆ·ç«¯è°ƒç”¨
- **åˆ›å»ºç»Ÿä¸€SupabaseæœåŠ¡**: supabaseClient.tsï¼ŒåŒ…å«authServiceã€nftServiceã€balanceServiceç­‰8ä¸ªæœåŠ¡æ¨¡å—
- **ç”¨æˆ·æ³¨å†Œå®Œæ•´æµç¨‹**: é’±åŒ…è¿æ¥ â†’ è‡ªåŠ¨å¼¹å‡ºæ³¨å†Œæ¨¡æ€æ¡† â†’ usersè¡¨è®°å½• â†’ referreråœ°å€æ•è·
- **MemberGuardè®¿é—®æ§åˆ¶**: å…¨ç«™é’±åŒ…è¿æ¥ä¿æŠ¤ + Dashboardä¼šå‘˜è®¿é—®é™åˆ¶
- **Headerç»„ä»¶ä¼˜åŒ–**: ç®€åŒ–ä¸ºç§»åŠ¨å‹å¥½è®¾è®¡ï¼Œåªä¿ç•™Logo + è¯­è¨€åˆ‡æ¢ + é’±åŒ…è¿æ¥
- **å¤šè¯­è¨€ç¿»è¯‘æ”¯æŒ**: ä¸º6ç§è¯­è¨€(EN/ZH/JA/KO/TH/MS)æ·»åŠ header.connectWalletç¿»è¯‘
- **useWallet hooké‡æ„**: ä½¿ç”¨æ–°SupabaseæœåŠ¡æ›¿ä»£æ—§APIè°ƒç”¨

#### æ ¸å¿ƒç»„ä»¶
- `src/lib/supabaseClient.ts` - ç»Ÿä¸€SupabaseæœåŠ¡å±‚
- `src/components/guards/MemberGuard.tsx` - è®¿é—®æ§åˆ¶ç»„ä»¶  
- `src/components/modals/RegistrationModal.tsx` - æ³¨å†Œå¼¹çª—ç»„ä»¶
- `src/components/shared/Header.tsx` - ç®€åŒ–Headerç»„ä»¶
- `src/hooks/useWallet.ts` - é‡æ„é’±åŒ…Hook

### ä¸‹ä¸€æ­¥è§„åˆ’ ğŸ¯

#### ç«‹å³æ‰§è¡Œ (æœ¬æ¬¡ä¼šè¯)
1. **å®ŒæˆWelcomeé¡µé¢æ›´æ–°** - ç¡®ä¿ä¸æ–°çš„MemberGuardå’ŒsupabaseClientå…¼å®¹
2. **å®ç°NFT claimåŸºç¡€ç•Œé¢** - ä¸‰ç§ç½‘ç»œé€‰æ‹©(Mainnet/Testnet/Simulation)  
3. **æ·»åŠ åŸºç¡€çŠ¶æ€ç®¡ç†** - å¤„ç†NFT claimçš„loadingå’ŒæˆåŠŸçŠ¶æ€

#### çŸ­æœŸç›®æ ‡ (1-2å¤©)  
1. **NFT claimé“¾ä¸Šé›†æˆ** - é›†æˆThirdweb EditionDropåˆçº¦è°ƒç”¨
2. **æ¿€æ´»åæ•°æ®å¤„ç†** - å®Œæˆorders/members/nft_purchasesè¡¨æ’å…¥é€»è¾‘
3. **åŸºç¡€çŸ©é˜µå®‰ç½®** - å®ç°referralsè¡¨çš„ç®€å•å®‰ç½®é€»è¾‘

#### ä¸­æœŸç›®æ ‡ (3-7å¤©)
1. **3Ã—3çŸ©é˜µç®—æ³•** - å®Œæ•´çš„Lâ†’Mâ†’Rå®‰ç½®ä¼˜å…ˆçº§ç®—æ³•
2. **Layerå¥–åŠ±ç³»ç»Ÿ** - pending/rollupæœºåˆ¶å®ç°  
3. **BCCä½™é¢ç®¡ç†** - locked/unlocked/transferableåˆ†ç±»ç®¡ç†
4. **Tieråˆ†é…ç³»ç»Ÿ** - åŸºäºæ¿€æ´»é¡ºåºçš„4å±‚tierç³»ç»Ÿ

#### é•¿æœŸç›®æ ‡ (1-2å‘¨)
1. **ç‰¹æ®Šä¸šåŠ¡è§„åˆ™** - Level 2å‡çº§é™åˆ¶ã€72å°æ—¶pendingæœºåˆ¶
2. **Dashboardå®Œæ•´åŠŸèƒ½** - çŸ©é˜µå¯è§†åŒ–ã€å¥–åŠ±æŸ¥çœ‹ã€ä½™é¢ç®¡ç†
3. **æ•°æ®åŒæ­¥ä¼˜åŒ–** - å®æ—¶çŠ¶æ€æ›´æ–°ã€é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–

---

## æ³¨æ„äº‹é¡¹
1. æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½è¦è€ƒè™‘äº‹åŠ¡ä¸€è‡´æ€§
2. é“¾ä¸Šäº¤æ˜“éœ€è¦è¶³å¤Ÿçš„ç¡®è®¤æ—¶é—´
3. çŸ©é˜µå®‰ç½®ç®—æ³•éœ€è¦è€ƒè™‘å¹¶å‘å®‰å…¨
4. å¥–åŠ±è®¡ç®—éœ€è¦ç²¾ç¡®çš„æ•°å­¦è®¡ç®—
5. ç”¨æˆ·ä½“éªŒè¦è€ƒè™‘loadingçŠ¶æ€å’Œé”™è¯¯å¤„ç†