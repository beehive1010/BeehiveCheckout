<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Supabase Session</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        .result {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #0f0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        button {
            background: #0f0;
            color: #000;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-family: monospace;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #0c0;
        }
        .error { color: #f00; }
        .success { color: #0f0; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>ðŸ§¹ Clear Supabase Session & Cache</h1>
    <p>This will clear all Supabase sessions and cached data</p>

    <div id="results"></div>

    <button onclick="clearEverything()">Clear All Supabase Data</button>
    <button onclick="showCurrentData()">Show Current Data</button>

    <script>
        function log(message, className = 'success') {
            const div = document.createElement('div');
            div.className = 'result ' + className;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function showCurrentData() {
            clearResults();
            log('ðŸ“Š Current LocalStorage Data:', 'warning');

            const supabaseKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('supabase')) {
                    supabaseKeys.push(key);
                    const value = localStorage.getItem(key);
                    log(`  ${key}: ${value ? value.substring(0, 100) + '...' : 'null'}`);
                }
            }

            if (supabaseKeys.length === 0) {
                log('  No Supabase data found in localStorage', 'success');
            }

            log('');
            log('ðŸ“Š Current SessionStorage Data:', 'warning');

            const sessionKeys = [];
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                if (key && key.includes('supabase')) {
                    sessionKeys.push(key);
                    const value = sessionStorage.getItem(key);
                    log(`  ${key}: ${value ? value.substring(0, 100) + '...' : 'null'}`);
                }
            }

            if (sessionKeys.length === 0) {
                log('  No Supabase data found in sessionStorage', 'success');
            }
        }

        async function clearEverything() {
            clearResults();
            log('ðŸ§¹ Starting cleanup...', 'warning');

            // 1. Clear all localStorage Supabase keys
            log('');
            log('ðŸ“¦ Clearing localStorage Supabase keys...');
            let localStorageCleared = 0;
            const keysToRemove = [];

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('supabase')) {
                    keysToRemove.push(key);
                }
            }

            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                localStorageCleared++;
                log(`  âœ“ Removed: ${key}`);
            });

            log(`âœ… Cleared ${localStorageCleared} localStorage keys`);

            // 2. Clear all sessionStorage Supabase keys
            log('');
            log('ðŸ“¦ Clearing sessionStorage Supabase keys...');
            let sessionStorageCleared = 0;
            const sessionKeysToRemove = [];

            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                if (key && key.includes('supabase')) {
                    sessionKeysToRemove.push(key);
                }
            }

            sessionKeysToRemove.forEach(key => {
                sessionStorage.removeItem(key);
                sessionStorageCleared++;
                log(`  âœ“ Removed: ${key}`);
            });

            log(`âœ… Cleared ${sessionStorageCleared} sessionStorage keys`);

            // 3. Clear browser cache
            log('');
            log('ðŸ—‘ï¸  Clearing browser cache...');
            try {
                const cacheKeys = await caches.keys();
                let cachesCleared = 0;

                for (const key of cacheKeys) {
                    await caches.delete(key);
                    cachesCleared++;
                    log(`  âœ“ Deleted cache: ${key}`);
                }

                log(`âœ… Cleared ${cachesCleared} cache storages`);
            } catch (error) {
                log(`âš ï¸  Could not clear caches: ${error.message}`, 'warning');
            }

            // 4. Clear cookies (if any)
            log('');
            log('ðŸª Clearing cookies...');
            const cookies = document.cookie.split(';');
            let cookiesCleared = 0;

            for (const cookie of cookies) {
                const eqPos = cookie.indexOf('=');
                const name = eqPos > -1 ? cookie.substring(0, eqPos).trim() : cookie.trim();

                if (name.includes('supabase') || name.includes('sb-')) {
                    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
                    cookiesCleared++;
                    log(`  âœ“ Cleared cookie: ${name}`);
                }
            }

            log(`âœ… Cleared ${cookiesCleared} cookies`);

            // 5. Summary
            log('');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
            log('âœ… CLEANUP COMPLETE!', 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
            log(`  localStorage keys: ${localStorageCleared}`, 'success');
            log(`  sessionStorage keys: ${sessionStorageCleared}`, 'success');
            log(`  Cookies: ${cookiesCleared}`, 'success');
            log('');
            log('âš ï¸  Please refresh the page now!', 'warning');
            log('');

            // Auto-reload after 3 seconds
            setTimeout(() => {
                log('ðŸ”„ Auto-reloading in 3 seconds...');
                setTimeout(() => {
                    location.reload();
                }, 3000);
            }, 1000);
        }

        // Auto-show current data on load
        window.addEventListener('load', () => {
            showCurrentData();
        });
    </script>
</body>
</html>
